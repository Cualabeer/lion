<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Super Admin Dashboard</title>
<style>
body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
h2 { margin-top: 40px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
button { margin: 2px; }
input, select { margin: 5px 0; }
</style>
</head>
<body>
<h1>Super Admin Dashboard</h1>

<section>
<h2>Garages</h2>
<table id="garageTable">
  <thead>
    <tr><th>ID</th><th>Name</th><th>Status</th><th>Action</th></tr>
  </thead>
  <tbody></tbody>
</table>
<button id="refreshGarages">Refresh Garages</button>
</section>

<section>
<h2>Bookings</h2>
<table id="bookingTable">
  <thead>
    <tr><th>ID</th><th>Customer</th><th>Garage</th><th>Vehicle</th><th>Date</th><th>Time</th><th>Status</th><th>Action</th></tr>
  </thead>
  <tbody></tbody>
</table>
<button id="refreshBookings">Refresh Bookings</button>
</section>

<section>
<h2>Verify Booking</h2>
<input type="text" id="verifyInput" placeholder="Enter Booking ID or scan QR">
<button id="verifyBtn">Verify</button>
<div id="verifyResult"></div>
</section>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabase = createClient('YOUR_SUPABASE_URL','YOUR_SUPABASE_KEY');

const garageTable = document.querySelector('#garageTable tbody');
const bookingTable = document.querySelector('#bookingTable tbody');
const verifyResult = document.getElementById('verifyResult');

// Load Garages
async function loadGarages(){
  garageTable.innerHTML='';
  const { data, error } = await supabase.from('garages').select('*');
  if(error) return console.error(error);
  data.forEach(g=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${g.id}</td><td>${g.name}</td><td>${g.status}</td>
      <td><button onclick="toggleGarage(${g.id}, '${g.status}')">${g.status==='Working'?'Set Offline':'Set Working'}</button></td>`;
    garageTable.appendChild(tr);
  });
}

// Toggle garage status
window.toggleGarage=async(id,status)=>{
  const newStatus=status==='Working'?'Offline':'Working';
  await supabase.from('garages').update({status:newStatus}).eq('id',id);
  loadGarages();
};

// Load Bookings
async function loadBookings(){
  bookingTable.innerHTML='';
  const { data, error } = await supabase.from('bookings').select('*,garages(name)');
  if(error) return console.error(error);
  data.forEach(b=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${b.id}</td><td>${b.name}</td><td>${b.garages.name}</td>
      <td>${b.vehicle_registration}</td><td>${b.date}</td><td>${b.time}</td>
      <td>${b.checked_in?'Checked In':'Pending'}</td>
      <td><button onclick="markCheckIn(${b.id})">Check In</button></td>`;
    bookingTable.appendChild(tr);
  });
}

// Check in booking
window.markCheckIn=async(id)=>{
  await supabase.from('bookings').update({checked_in:true}).eq('id',id);
  loadBookings();
};

// Verify booking
document.getElementById('verifyBtn').addEventListener('click', async ()=>{
  const id=document.getElementById('verifyInput').value;
  const { data, error } = await supabase.from('bookings').select('*').eq('id',id).single();
  if(error||!data){ verifyResult.innerText='Booking not found'; return; }
  verifyResult.innerHTML=`Booking Verified âœ…<br>Name: ${data.name}<br>Vehicle: ${data.vehicle_registration}<br>Garage ID: ${data.garage_id}<br>Date: ${data.date} Time: ${data.time}`;
  await supabase.from('bookings').update({checked_in:true}).eq('id',id);
});

document.getElementById('refreshGarages').addEventListener('click',loadGarages);
document.getElementById('refreshBookings').addEventListener('click',loadBookings);

loadGarages();
loadBookings();
</script>
</body>
</html>